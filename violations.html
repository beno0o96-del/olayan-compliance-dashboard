<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Violations - Olayan Compliance</title>
    <link rel="stylesheet" href="style-base.css">
    <link rel="stylesheet" href="style-home.css">
    <link rel="stylesheet" href="style-violations.css">
    <link rel="icon" type="image/svg+xml" href="olayan-mark.svg">
    <link rel="apple-touch-icon" href="olayan-logo.png">
    <link rel="mask-icon" href="olayan-mark.svg" color="#2d6cdf">
    <meta name="theme-color" content="#0b0e2b">
    <script src="app.js?v=4" defer></script>
    <script src="od_config.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@azure/msal-browser@2.37.0/dist/msal-browser.min.js" defer></script>
    <script src="onedrive_activity.js" defer></script>
    <script src="github_activity.js" defer></script>
</head>
<body class="en">
  <div class="brand-bar">
    <img src="olayan-logo.png" alt="Olayan">
    <span class="brand-name">Olayan Compliance Dashboard</span>
    <span class="brand-info" id="file-activity"></span>
  </div>

    <!-- Hamburger Button -->
    <button class="hamburger-btn" onclick="toggleMenu()">
        <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>

    <!-- Sliding Side Menu -->
    <div class="side-menu-overlay" id="sideMenuOverlay" onclick="toggleMenu()"></div>
    <aside class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <img src="olayan-logo.png" class="side-menu-logo" alt="Logo">
            <button class="close-menu-btn" onclick="toggleMenu()">&times;</button>
        </div>
        <nav class="side-menu-nav">
            <a href="index.html" class="side-link">
                <i>🏠</i> <span data-en="Home" data-ar="الرئيسية">Home</span>
            </a>
            <a href="violations.html" class="side-link active">
                <i>⚠️</i> <span data-en="Violations" data-ar="المخالفات">Violations</span>
            </a>
            <a href="training.html" class="side-link">
                <i>🎓</i> <span data-en="Training" data-ar="التدريب">Training</span>
            </a>
            <a href="branches.html" class="side-link">
                <i>🏬</i> <span data-en="Branches" data-ar="الفروع">Branches</span>
            </a>
            <a href="board.html" class="side-link">
                <i>📊</i> <span data-en="Board Report" data-ar="تقرير الإدارة">Board Report</span>
            </a>
            <hr style="border-color: rgba(255,255,255,0.1); width: 100%;">
            <a href="#" onclick="toggleServicesDashboard(); return false;" class="side-link">
                <i>🛠</i> <span data-en="Services Dashboard" data-ar="لوحة الخدمات">Services Dashboard</span>
            </a>
            <a href="admin.html" class="side-link">
                <i>⚙️</i> <span data-en="Admin Panel" data-ar="لوحة التحكم">Admin Panel</span>
            </a>
        </nav>
        <div style="margin-top: auto; padding-top: 20px;">
            <div class="lang-switch" style="display: flex; gap: 10px; justify-content: center;"> 
                <button class="lang-btn" onclick="setLang('ar')" style="flex:1;">العربية</button> 
                <button class="lang-btn" onclick="setLang('en')" style="flex:1;">English</button> 
            </div>
        </div>
    </aside>

    <!-- Services Dashboard Modal (Full Screen) -->
    <div id="services-modal" class="services-modal">
        <div class="services-modal-content">
            <div class="services-header">
                <h2 data-en="Services Dashboard" data-ar="لوحة الخدمات">Services Dashboard</h2>
                <button class="close-services-btn" onclick="toggleServicesDashboard()">&times;</button>
            </div>
            
            <div class="toolbar">
                <button class="toolbar-btn btn-print" onclick="printServices()">
                    <span data-en="Print" data-ar="طباعة">Print</span> 🖨
                </button>
                <button class="toolbar-btn btn-rate" onclick="window.open('https://forms.gle/1z5jwhtF7LLqWvbQ9', '_blank')" style="background: rgba(155, 89, 182, 0.2); border: 1px solid rgba(155, 89, 182, 0.3); color: #9b59b6;"><span data-en="Rate Us" data-ar="قيمنا">Rate Us</span> </button><button class="toolbar-btn btn-export" onclick="exportServicesExcel()">
                    <span data-en="Export Excel" data-ar="تصدير Excel">Export Excel</span> 📊
                </button>
            </div>

            <div class="kpi-grid">
                 <div class="kpi-card">
                    <span class="kpi-title" data-en="Active Requests" data-ar="الطلبات النشطة">Active Requests</span>
                    <h3>142</h3>
                 </div>
                 <div class="kpi-card">
                    <span class="kpi-title" data-en="Completed Today" data-ar="أنجزت اليوم">Completed Today</span>
                    <h3>28</h3>
                 </div>
                 <div class="kpi-card">
                    <span class="kpi-title" data-en="Avg Response Time" data-ar="متوسط زمن الاستجابة">Avg Response Time</span>
                    <h3>2.4h</h3>
                 </div>
                 <div class="kpi-card">
                    <span class="kpi-title" data-en="Employee Satisfaction" data-ar="رضا الموظفين">Employee Satisfaction</span>
                    <h3>98%</h3>
                 </div>
            </div>

            <div class="services-table-container">
                <table id="servicesTable" class="services-table">
                    <thead>
                        <tr>
                            <th data-en="ID" data-ar="رقم الطلب">ID</th>
                            <th data-en="Service Type" data-ar="نوع الخدمة">Service Type</th>
                            <th data-en="Status" data-ar="الحالة">Status</th>
                            <th data-en="Priority" data-ar="الأولوية">Priority</th>
                            <th data-en="Date" data-ar="التاريخ">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>#REQ-001</td><td>Maintenance</td><td>In Progress</td><td>High</td><td>2025-01-10</td></tr>
                        <tr><td>#REQ-002</td><td>IT Support</td><td>Pending</td><td>Medium</td><td>2025-01-11</td></tr>
                        <tr><td>#REQ-003</td><td>Logistics</td><td>Completed</td><td>Low</td><td>2025-01-09</td></tr>
                        <tr><td>#REQ-004</td><td>HR Request</td><td>Completed</td><td>High</td><td>2025-01-08</td></tr>
                        <tr><td>#REQ-005</td><td>Cleaning</td><td>In Progress</td><td>Medium</td><td>2025-01-12</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <header class="main-header">
        <div class="header-left" style="display: flex; align-items: center;">
            <img src="olayan-logo.png" class="logo" alt="Olayan Logo">
            <div class="company-text">
                <h1 data-en="Olayan Food Division" data-ar="شركة العليان الغذائية">Olayan Food Division</h1>
                <p data-en="Burger King · Texas Chicken · Buffalo Wild Wings" data-ar="برجر كنج · دجاج تكساس · بافلو وايلد وينجز">Burger King · Texas Chicken · Buffalo Wild Wings</p>
            </div>
        </div>
        <div class="header-right">
            <nav class="main-nav" style="display: none;"> 
      <button class="nav-btn" onclick="location.href='index.html'" data-en="Home" data-ar="الرئيسية">Home</button> 
      <button class="nav-btn active" onclick="location.href='violations.html'" data-en="Violations" data-ar="المخالفات">Violations</button> 
      <button class="nav-btn" onclick="location.href='training.html'" data-en="Training" data-ar="التدريب">Training</button> 
      <button class="nav-btn" onclick="location.href='branches.html'" data-en="Branches" data-ar="الفروع">Branches</button> 
      <button class="nav-btn" onclick="location.href='board.html'" data-en="Board Report" data-ar="تقرير الإدارة">Board Report</button> 
    </nav>
            <div class="lang-switch">
                <button class="lang-btn" onclick="setLang('ar')">AR</button>
                <button class="lang-btn" onclick="setLang('en')">EN</button>
            </div>
        </div>
    </header>
    <div class="header-spacer"></div>

    <div class="violations-header">
        <h1 data-en="Violations Management" data-ar="إدارة المخالفات">Violations Management</h1>
    </div>

    <div class="kpi-section">
        <!-- Summary Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <span class="kpi-title" data-en="Total Violations" data-ar="إجمالي المخالفات">Total Violations</span>
                <h3 id="v-total-count">Loading...</h3>
            </div>
            <div class="kpi-card">
                <span class="kpi-title" data-en="Total Amount (SAR)" data-ar="إجمالي المبالغ (ريال)">Total Amount (SAR)</span>
                <h3 id="v-total-amount">Loading...</h3>
            </div>
            <div class="kpi-card">
                <span class="kpi-title" data-en="Most Frequent Branch" data-ar="الفرع الأكثر تكراراً">Most Frequent Branch</span>
                <h3 id="v-top-freq-branch" style="font-size: 1.5rem;">Loading...</h3>
            </div>
            <div class="kpi-card">
                <span class="kpi-title" data-en="Highest Risk Branch" data-ar="الفرع الأعلى خطورة">Highest Risk Branch</span>
                <h3 id="v-top-risk-branch" style="font-size: 1.5rem;">Loading...</h3>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-container">
            <!-- Top 15 Frequency -->
            <div class="chart-card">
                <h3 data-en="Branches – Repeat Violations" data-ar="الفروع – تكرار المخالفات">Branches – Repeat Violations</h3>
                <div id="chart-freq" class="bar-chart"></div>
            </div>

            <!-- Regional Analysis -->
            <div class="chart-card">
                <h3 data-en="Violations by Region" data-ar="المخالفات حسب المنطقة">Violations by Region</h3>
                <div id="chart-region" class="bar-chart"></div>
            </div>

            <!-- Top 15 Risk -->
            <div class="chart-card">
                <h3 data-en="Branches – Highest Risk (Amount)" data-ar="الفروع – أعلى خطورة (المبلغ)">Branches – Highest Risk (Amount)</h3>
                <div id="chart-risk" class="bar-chart"></div>
            </div>
        </div>
        
        <!-- Violation Types List -->
         <div class="chart-card" style="margin-top: 30px;">
            <h3 data-en="Most Common Violation Types" data-ar="أنواع المخالفات الأكثر شيوعاً">Most Common Violation Types</h3>
            <div id="list-types" class="types-list"></div>
        </div>

    </div>

    <!-- Violation Details Modal -->
    <div id="violation-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <div id="modal-icon" class="modal-icon-large"></div>
                <h2 id="modal-title">Violation Details</h2>
            </div>
            <div id="modal-body">
                <!-- Details will be injected here -->
            </div>
        </div>
    </div>


    <!-- ================= FOOTER ================= --> 
    <footer class="main-footer"> 
        <span data-ar="جميع الحقوق محفوظة لدى شركة العليان للخدمات الغذائية © 2025" 
                data-en="All rights reserved – Olayan Food Services Company © 2025"> 
            جميع الحقوق محفوظة لدى شركة العليان للخدمات الغذائية © 2025 
        </span> 
        <br> 
        Developed by <strong>Bandar A. Abdulwahab</strong> 
    </footer>
</body>
</html>
