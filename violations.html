<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª | Olayan Services</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style-admin.css?v=8">
    <!-- Keeping style-violations.css for specific chart/table styles, but overriding layout -->
    <link rel="stylesheet" href="style-violations.css"> 
    <link rel="icon" type="image/svg+xml" href="olayan-mark.svg">
    
    <style>
        /* Overrides to integrate with Admin Theme */
        body { background: var(--bg-dark); } /* Force admin background */
        .violations-header { display: none; } /* Hide old header */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            color: #fff;
        }
        .kpi-title { color: var(--text-muted); font-size: 0.9rem; display: block; margin-bottom: 10px; }
        .kpi-card h3 { font-size: 1.8rem; margin: 0; color: #fff; }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
        }
        .chart-card h3 { color: #fff; margin-bottom: 20px; font-size: 1.1rem; }
        
        /* Table overrides */
        .comparison-table { width: 100%; border-collapse: collapse; }
        .comparison-table th { text-align: right; color: var(--text-muted); padding: 10px; border-bottom: 1px solid var(--border-color); }
        .comparison-table td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #fff; }
        
        /* Bar Chart Bars */
        .bar-chart-bar { background: var(--primary-color); }
    </style>
    
    <!-- Scripts -->
    <script src="app.js?v=6" defer></script>
</head>
<body class="ar">

    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <img src="olayan-logo.png" class="sidebar-logo" alt="Logo">
            <span class="sidebar-brand">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </div>
        <nav class="sidebar-nav">
            <!-- Group 1: Leadership -->
            <div class="nav-group" id="group-leadership">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-leadership')">
                    <span>ğŸ“Š Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-dashboard">
                        <i>ğŸ </i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-analytics">
                        <i>ğŸ§ </i> Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ (AI)
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-tasks">
                        <i>âœ…</i> Ø§Ù„Ù…Ù‡Ø§Ù…
                    </a>
                </div>
            </div>

            <!-- Group 2: Data Management -->
            <div class="nav-group active" id="group-data">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-data')">
                    <span>ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    <i class="arrow-icon">â–¼</i>
                </div>
                <div class="nav-group-content">
                    <a href="admin.html" class="nav-item" id="nav-employees">
                        <i>ğŸ‘¥</i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </a>
                    <a href="violations.html" class="nav-item active" id="nav-violations">
                        <i>âš ï¸</i> Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
                    </a>
                    <a href="training.html" class="nav-item" id="nav-training">
                        <i>ğŸ“</i> Ø§Ù„ØªØ¯Ø±ÙŠØ¨
                    </a>
                    <a href="branches.html" class="nav-item" id="nav-branches">
                        <i>ğŸ¬</i> Ø§Ù„ÙØ±ÙˆØ¹
                    </a>
                    <a href="licenses.html" class="nav-item" id="nav-licenses">
                        <i>ğŸ“œ</i> Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-advanced-data">
                        <i>ğŸ’¾</i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    </a>
                </div>
            </div>

            <!-- Group 3: Users & Services -->
            <div class="nav-group" id="group-users">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-users')">
                    <span>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-users">
                        <i>ğŸ‘¤</i> Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-services">
                        <i>ğŸ“©</i> Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª
                    </a>
                </div>
            </div>

            <!-- Group 4: System -->
            <div class="nav-group" id="group-system">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-system')">
                    <span>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-settings">
                        <i>âš™ï¸</i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </a>
                    <a href="admin.html" class="nav-item"><i>ğŸ–¼ï¸</i> Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ“„</i> Ø§Ù„ØµÙØ­Ø§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ’¬</i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ¨</i> Ø§Ù„Ù…Ø¸Ù‡Ø±</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ§©</i> Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ› ï¸</i> Ø§Ù„Ø£Ø¯ÙˆØ§Øª</a>
                    <a href="admin.html" class="nav-item"><i>âœ‰ï¸</i> Ø§Ù„Ø¨Ø±ÙŠØ¯</a>
                </div>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 20px;"></div>
            
            <a href="board.html" target="_blank" class="nav-item" style="margin: 0 10px;">
                <i>ğŸ”—</i> Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ù…ÙˆÙ‚Ø¹
            </a>
        </nav>
        <div style="padding: 20px;">
            <button id="logout" class="btn btn-danger" style="width: 100%; justify-content: center;" onclick="location.href='index.html'">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="sidebar-footer" style="padding: 10px 20px; text-align: center; font-size: 0.7rem; color: #64748b; border-top: 1px solid #eee;">
            <div style="margin-bottom: 5px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¯Ù‰ Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù„ÙŠØ§Ù† Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Â© 2025</div>
            <div style="direction: ltr;">Developed by Bandar A. Abdulwahab</div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <button id="sidebar-toggle" class="btn btn-glass" style="margin-inline-end: 15px; display: none;">â˜°</button>
            <div class="header-title">Ù„ÙˆØ­Ø© Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</div>
            <div class="header-actions">
                <div class="status-pill">
                    <span class="status-dot" style="background: #f59e0b;"></span>
                    <span class="status-text">Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙŠØ©</span>
                </div>
                
                <div class="lang-toggle">
                    <button class="btn-icon-text active">Ø¹Ø±Ø¨ÙŠ</button>
                    <span class="divider">|</span>
                    <button class="btn-icon-text" onclick="alert('English coming soon')">En</button>
                </div>
            </div>
        </header>

        <div class="admin-content-wrapper">
            
            <!-- Summary Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <span class="kpi-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</span>
                    <h3 id="v-total-count">...</h3>
                </div>
                <div class="kpi-card">
                    <span class="kpi-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ø§Ù…Ø§Øª (Ø±ÙŠØ§Ù„)</span>
                    <h3 id="v-total-amount">...</h3>
                </div>
                <div class="kpi-card">
                    <span class="kpi-title">Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</span>
                    <h3 id="v-top-freq-branch" style="font-size: 1.3rem;">...</h3>
                </div>
                <div class="kpi-card">
                    <span class="kpi-title">Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø®Ø·ÙˆØ±Ø©</span>
                    <h3 id="v-top-risk-branch" style="font-size: 1.3rem;">...</h3>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
                <!-- Top 15 Frequency -->
                <div class="chart-card">
                    <h3>Ø§Ù„ÙØ±ÙˆØ¹ â€“ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª (Top 15)</h3>
                    <div id="chart-freq" class="bar-chart" style="height: 300px;"></div>
                </div>

                <!-- Regional Analysis -->
                <div class="chart-card">
                    <h3>Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
                    <div id="chart-region" class="bar-chart" style="height: 300px;"></div>
                </div>

                <!-- Regional Comparison Matrix -->
                <div class="chart-card" style="grid-column: 1 / -1;">
                    <h3>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠ</h3>
                    <div class="table-responsive">
                        <table class="comparison-table" id="region-comparison-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</th>
                                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ø§Ù…Ø§Øª</th>
                                    <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                                    <th>Ø£ÙƒØ«Ø± Ù…Ø®Ø§Ù„ÙØ© Ø´ÙŠÙˆØ¹Ø§Ù‹</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic Content -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Top 15 Risk -->
                <div class="chart-card">
                    <h3>Ø§Ù„ÙØ±ÙˆØ¹ â€“ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø®Ø·ÙˆØ±Ø© Ø¨Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h3>
                    <div id="chart-risk" class="bar-chart" style="height: 300px;"></div>
                </div>
                
                <!-- Types List -->
                 <div class="chart-card">
                    <h3>Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹</h3>
                    <div id="list-types" class="types-list"></div>
                </div>
            </div>

        </div>
    </main>

    <!-- Violation Details Modal -->
    <div id="violation-modal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:2000; align-items:center; justify-content:center;">
        <div class="modal-content" style="background:#1e293b; color:#fff; padding:30px; border-radius:16px; width:90%; max-width:500px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 id="modal-title">ØªÙØ§ØµÙŠÙ„</h2>
                <span class="close-modal" onclick="document.getElementById('violation-modal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Sidebar Group Toggle
        function toggleSidebarGroup(groupId) {
            const group = document.getElementById(groupId);
            if(!group) return;
            const content = group.querySelector('.nav-group-content');
            const arrow = group.querySelector('.arrow-icon');
            const isActive = group.classList.contains('active');
            if(isActive) {
                group.classList.remove('active');
                content.style.display = 'none';
                if(arrow) arrow.textContent = 'â–¶';
            } else {
                group.classList.add('active');
                content.style.display = 'block';
                if(arrow) arrow.textContent = 'â–¼';
            }
        }

        // Sidebar Toggle
        const toggleBtn = document.getElementById('sidebar-toggle');
        const sidebar = document.querySelector('.admin-sidebar');
        if(toggleBtn && sidebar) {
            toggleBtn.style.display = 'block';
            toggleBtn.onclick = () => sidebar.classList.toggle('active');
        }
        // Load Violations for Table
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('list-types'); // Using the types list container for now
            // Or if there is a main table, we should find it. 
            // Looking at previous Read, there isn't a big table, just "types-list".
            // Let's inject a proper table if possible or just populate the list.
            
            const rawData = JSON.parse(localStorage.getItem('admin_violations_raw') || '[]');
            const statsData = JSON.parse(localStorage.getItem('violations_data_override') || '{}');
            
            // Render Types List (Common Violations)
            if(container && statsData.common_types) {
                container.innerHTML = statsData.common_types.map(t => `
                    <div class="type-item">
                        <span>${t.type}</span>
                        <span class="count-badge">${t.count}</span>
                    </div>
                `).join('');
            }
            
            // If there's a place for a detailed table, we could add it.
            // But based on the file content read earlier, it seems to focus on charts and summary cards.
        });
    </script>
</body>
</html>
