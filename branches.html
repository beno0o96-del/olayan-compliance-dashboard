<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙØ±ÙˆØ¹ | Olayan Services</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style-admin.css?v=8">
    <link rel="icon" type="image/svg+xml" href="olayan-mark.svg">
    
    <style>
        /* Local overrides for public page compatibility */
        .branches-container {
            padding: 0;
        }
        .opening-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: var(--transition);
        }
        .opening-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-glow);
        }
        .opening-location {
            color: #fff;
            font-size: 1.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #fff;
            border-right: 4px solid var(--primary-color);
            padding-right: 15px;
        }
        .openings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .brand-logo-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .brand-logo-img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }
        .opening-content { padding: 20px; }
        .opening-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status-opening-soon { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .status-now-open { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    </style>
</head>
<body class="ar">

    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <img src="olayan-logo.png" class="sidebar-logo" alt="Logo">
            <span class="sidebar-brand">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </div>
        <nav class="sidebar-nav">
            <!-- Group 1: Leadership -->
            <div class="nav-group" id="group-leadership">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-leadership')">
                    <span>ğŸ“Š Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-dashboard">
                        <i>ğŸ </i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-analytics">
                        <i>ğŸ§ </i> Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ (AI)
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-tasks">
                        <i>âœ…</i> Ø§Ù„Ù…Ù‡Ø§Ù…
                    </a>
                </div>
            </div>

            <!-- Group 2: Data Management -->
            <div class="nav-group active" id="group-data">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-data')">
                    <span>ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    <i class="arrow-icon">â–¼</i>
                </div>
                <div class="nav-group-content">
                    <a href="admin.html" class="nav-item" id="nav-employees">
                        <i>ğŸ‘¥</i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </a>
                    <a href="violations.html" class="nav-item" id="nav-violations">
                        <i>âš ï¸</i> Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
                    </a>
                    <a href="training.html" class="nav-item" id="nav-training">
                        <i>ğŸ“</i> Ø§Ù„ØªØ¯Ø±ÙŠØ¨
                    </a>
                    <a href="branches.html" class="nav-item active" id="nav-branches">
                        <i>ğŸ¬</i> Ø§Ù„ÙØ±ÙˆØ¹
                    </a>
                    <a href="licenses.html" class="nav-item" id="nav-licenses">
                        <i>ğŸ“œ</i> Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-advanced-data">
                        <i>ğŸ’¾</i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    </a>
                </div>
            </div>

            <!-- Group 3: Users & Services -->
            <div class="nav-group" id="group-users">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-users')">
                    <span>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-users">
                        <i>ğŸ‘¤</i> Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                    </a>
                    <a href="admin.html" class="nav-item" id="nav-services">
                        <i>ğŸ“©</i> Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª
                    </a>
                </div>
            </div>

            <!-- Group 4: System -->
            <div class="nav-group" id="group-system">
                <div class="nav-group-header" onclick="toggleSidebarGroup('group-system')">
                    <span>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    <i class="arrow-icon">â–¶</i>
                </div>
                <div class="nav-group-content" style="display:none;">
                    <a href="admin.html" class="nav-item" id="nav-settings">
                        <i>âš™ï¸</i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </a>
                    <a href="admin.html" class="nav-item"><i>ğŸ–¼ï¸</i> Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</a>
                    <a href="admin.html" class="nav-item"><i>ï¿½</i> Ø§Ù„ØµÙØ­Ø§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ’¬</i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ¨</i> Ø§Ù„Ù…Ø¸Ù‡Ø±</a>
                    <a href="admin.html" class="nav-item"><i>ğŸ§©</i> Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</a>
                    <a href="admin.html" class="nav-item"><i>ï¿½ï¸</i> Ø§Ù„Ø£Ø¯ÙˆØ§Øª</a>
                    <a href="admin.html" class="nav-item"><i>âœ‰ï¸</i> Ø§Ù„Ø¨Ø±ÙŠØ¯</a>
                </div>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 20px;"></div>
            
            <a href="board.html" target="_blank" class="nav-item" style="margin: 0 10px;">
                <i>ğŸ”—</i> Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ù…ÙˆÙ‚Ø¹
            </a>
        </nav>
        <div style="padding: 20px;">
            <button id="logout" class="btn btn-danger" style="width: 100%; justify-content: center;" onclick="location.href='index.html'">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="sidebar-footer" style="padding: 10px 20px; text-align: center; font-size: 0.7rem; color: #64748b; border-top: 1px solid #eee;">
            <div style="margin-bottom: 5px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¯Ù‰ Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù„ÙŠØ§Ù† Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Â© 2025</div>
            <div style="direction: ltr;">Developed by Bandar A. Abdulwahab</div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <button id="sidebar-toggle" class="btn btn-glass" style="margin-inline-end: 15px; display: none;">â˜°</button>
            <div class="header-title">Ø´Ø¨ÙƒØ© Ø§Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            <div class="header-actions">
                <div class="status-pill">
                    <span class="status-dot" style="background: #10b981;"></span>
                    <span class="status-text">Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„</span>
                </div>
                
                <div class="lang-toggle">
                    <button class="btn-icon-text active">Ø¹Ø±Ø¨ÙŠ</button>
                    <span class="divider">|</span>
                    <button class="btn-icon-text" onclick="alert('English coming soon')">En</button>
                </div>
            </div>
        </header>

        <div class="admin-content-wrapper">
            
            <!-- New Openings Section -->
            <h2 class="section-title">Ø§Ù„Ø§ÙØªØªØ§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            
            <div class="openings-grid">
                <!-- Najran Region -->
                <div class="opening-card">
                    <div class="opening-content">
                        <span class="opening-status status-opening-soon">Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div class="brand-logo-circle"><img src="bk-logo.png" class="brand-logo-img" alt="BK"></div>
                            <span style="color:var(--text-muted);">Burger King</span>
                        </div>
                        <div class="opening-location">Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù†</div>
                        <div style="color:var(--text-muted); font-size:0.9rem;">
                            ğŸ“… Ø§Ù„Ø§ÙØªØªØ§Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: 01-01-2026
                        </div>
                    </div>
                </div>

                <!-- Tabuk Airport -->
                <div class="opening-card">
                    <div class="opening-content">
                        <span class="opening-status status-opening-soon">Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div class="brand-logo-circle"><img src="bk-logo.png" class="brand-logo-img" alt="BK"></div>
                            <span style="color:var(--text-muted);">Burger King</span>
                        </div>
                        <div class="opening-location">Ù…Ø·Ø§Ø± ØªØ¨ÙˆÙƒ</div>
                        <div style="color:var(--text-muted); font-size:0.9rem;">
                            ğŸ“… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù„Ø§Ø­Ù‚Ø§Ù‹
                        </div>
                    </div>
                </div>

                <!-- Taif Airport -->
                <div class="opening-card">
                    <div class="opening-content">
                        <span class="opening-status status-opening-soon">Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div class="brand-logo-circle"><img src="bk-logo.png" class="brand-logo-img" alt="BK"></div>
                            <span style="color:var(--text-muted);">Burger King</span>
                        </div>
                        <div class="opening-location">Ù…Ø·Ø§Ø± Ø§Ù„Ø·Ø§ÙŠÙ</div>
                        <div style="color:var(--text-muted); font-size:0.9rem;">
                            ğŸ“… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù„Ø§Ø­Ù‚Ø§Ù‹
                        </div>
                    </div>
                </div>
            </div>

            <!-- AUTO-GENERATED BRANCHES -->
            <h2 class="section-title" style="margin-top: 50px;">Ø´Ø¨ÙƒØ© Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù†Ø´Ø·Ø©</h2>
            <div id="dynamic-branches" class="openings-grid">
                <!-- Loaded from admin_branches -->
            </div>

        </div>
    </main>

    <!-- Branch Details Modal -->
    <div id="branch-modal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:2000; align-items:center; justify-content:center; backdrop-filter:blur(5px);">
        <div class="modal-content" style="background:linear-gradient(145deg, #1e293b, #0f172a); color:#fff; padding:0; border-radius:20px; width:95%; max-width:800px; max-height:90vh; overflow-y:auto; border:1px solid rgba(255,255,255,0.1); box-shadow:0 25px 50px rgba(0,0,0,0.5);">
            
            <!-- Modal Header -->
            <div style="padding:20px 30px; background:rgba(0,0,0,0.2); display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1);">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div id="modal-logo" style="width:50px; height:50px; background:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                        <img src="olayan-logo.png" style="width:80%; height:80%; object-fit:contain;">
                    </div>
                    <div>
                        <h2 id="modal-title" style="margin:0; font-size:1.5rem;">Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹</h2>
                        <span id="modal-subtitle" style="color:#94a3b8; font-size:0.9rem;">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span>
                    </div>
                </div>
                <button onclick="document.getElementById('branch-modal').style.display='none'" style="background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
            </div>

            <!-- Modal Body -->
            <div style="padding:30px;">
                
                <!-- KPI Cards -->
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px; margin-bottom:30px;">
                    <div class="kpi-box" style="background:rgba(59, 130, 246, 0.1); padding:15px; border-radius:12px; border:1px solid rgba(59, 130, 246, 0.3); text-align:center;">
                        <div style="font-size:2rem; margin-bottom:5px;">ğŸ‘¥</div>
                        <div style="color:#94a3b8; font-size:0.8rem;">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                        <div id="modal-emp-count" style="font-size:1.5rem; font-weight:bold; color:#60a5fa;">0</div>
                    </div>
                    <div class="kpi-box" style="background:rgba(239, 68, 68, 0.1); padding:15px; border-radius:12px; border:1px solid rgba(239, 68, 68, 0.3); text-align:center;">
                        <div style="font-size:2rem; margin-bottom:5px;">âš ï¸</div>
                        <div style="color:#94a3b8; font-size:0.8rem;">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</div>
                        <div id="modal-vio-count" style="font-size:1.5rem; font-weight:bold; color:#f87171;">0</div>
                    </div>
                    <div class="kpi-box" style="background:rgba(16, 185, 129, 0.1); padding:15px; border-radius:12px; border:1px solid rgba(16, 185, 129, 0.3); text-align:center;">
                        <div style="font-size:2rem; margin-bottom:5px;">ğŸ“œ</div>
                        <div style="color:#94a3b8; font-size:0.8rem;">Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</div>
                        <div id="modal-lic-status" style="font-size:1.2rem; font-weight:bold; color:#34d399;">Ø³Ø§Ø±ÙŠØ©</div>
                    </div>
                </div>

                <!-- Licenses Grid -->
                <h3 style="border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:20px; color:#e2e8f0;">ğŸ“‚ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ÙˆØ§Ù„ØªØµØ§Ø±ÙŠØ­</h3>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px; margin-bottom:30px;">
                    
                    <!-- Baladiya -->
                    <div class="license-card" style="background:#1e293b; padding:20px; border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                            <span style="font-weight:bold; color:#cbd5e1;">ğŸ›ï¸ Ø±Ø®ØµØ© Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</span>
                            <span id="lic-baladiya-status" class="status-badge">...</span>
                        </div>
                        <div style="font-size:0.9rem; color:#94a3b8;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <span id="lic-baladiya-date" style="color:#fff;">-</span></div>
                    </div>

                    <!-- Civil Defense -->
                    <div class="license-card" style="background:#1e293b; padding:20px; border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                            <span style="font-weight:bold; color:#cbd5e1;">ğŸš’ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ</span>
                            <span id="lic-civil-status" class="status-badge">...</span>
                        </div>
                        <div style="font-size:0.9rem; color:#94a3b8;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <span id="lic-civil-date" style="color:#fff;">-</span></div>
                    </div>

                    <!-- 24H Permit -->
                    <div class="license-card" style="background:#1e293b; padding:20px; border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                            <span style="font-weight:bold; color:#cbd5e1;">ğŸŒ™ ØªØµØ±ÙŠØ­ 24 Ø³Ø§Ø¹Ø©</span>
                            <span id="lic-24h-status" class="status-badge">...</span>
                        </div>
                        <div style="font-size:0.9rem; color:#94a3b8;">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="lic-24h-text" style="color:#fff;">-</span></div>
                    </div>

                    <!-- Delivery Permit -->
                    <div class="license-card" style="background:#1e293b; padding:20px; border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                            <span style="font-weight:bold; color:#cbd5e1;">ğŸ›µ ØªØµØ±ÙŠØ­ Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                            <span id="lic-delivery-status" class="status-badge">...</span>
                        </div>
                        <div style="font-size:0.9rem; color:#94a3b8;">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="lic-delivery-text" style="color:#fff;">-</span></div>
                    </div>

                </div>

                <!-- Violations List -->
                <h3 style="border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:20px; color:#e2e8f0;">âš ï¸ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</h3>
                <div id="modal-violations-list" style="max-height:200px; overflow-y:auto; background:#1e293b; border-radius:12px; padding:10px;">
                    <!-- Items -->
                </div>

            </div>
        </div>
    </div>

    <script>
        // ... (Existing Sidebar Logic) ...
        
        // Helper to normalize strings for comparison
        const norm = str => str ? str.toString().toLowerCase().trim().replace(/[^a-z0-9\u0600-\u06FF]/g, '') : '';

        // Load Dynamic Branches with Full Details
        document.addEventListener('DOMContentLoaded', () => {
            // Load all datasets
            const branchesRaw = JSON.parse(localStorage.getItem('admin_branches_data') || '[]');
            const employees = JSON.parse(localStorage.getItem('admin_employees') || '[]');
            const violations = JSON.parse(localStorage.getItem('admin_violations_raw') || '[]');
            const licenses = JSON.parse(localStorage.getItem('admin_licenses') || '[]');

            const container = document.getElementById('dynamic-branches');
            
            if (branchesRaw.length > 0 && container) {
                container.innerHTML = ''; // Clear existing content
                
                // Deduplicate branches if needed
                const uniqueBranches = [...new Set(branchesRaw.map(b => typeof b === 'string' ? b : b.name))];

                uniqueBranches.forEach(branchName => {
                    if(!branchName || branchName === 'Unknown Branch') return;

                    // Aggregate Data
                    const bKey = norm(branchName);
                    
                    // 1. Employees Count
                    const empCount = employees.filter(e => norm(e.branch).includes(bKey) || bKey.includes(norm(e.branch))).length;
                    
                    // 2. Violations Count
                    const branchViolations = violations.filter(v => norm(v.branch).includes(bKey) || bKey.includes(norm(v.branch)));
                    const vioCount = branchViolations.length;
                    
                    // 3. License Info
                    const licInfo = licenses.find(l => norm(l.branch).includes(bKey) || bKey.includes(norm(l.branch))) || {};

                    // Brand Logic
                    let brand = 'Olayan';
                    const lowerName = branchName.toLowerCase();
                    if(lowerName.includes('bk') || lowerName.includes('king') || lowerName.includes('Ø¨Ø±Ø¬Ø±')) brand = 'Burger King';
                    else if(lowerName.includes('texas') || lowerName.includes('chicken') || lowerName.includes('ØªÙƒØ³Ø§Ø³')) brand = 'Texas Chicken';
                    else if(lowerName.includes('bww') || lowerName.includes('buffalo') || lowerName.includes('Ø¨Ø§ÙÙ„Ùˆ')) brand = 'Buffalo Wild Wings';

                    // Create Card
                    const div = document.createElement('div');
                    div.className = 'opening-card';
                    div.style.cursor = 'pointer';
                    div.onclick = () => openBranchModal(branchName, brand, empCount, branchViolations, licInfo);
                    
                    div.innerHTML = `
                        <div class="opening-content">
                            <span class="opening-status status-now-open">Ù†Ø´Ø·</span>
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                                <div class="brand-logo-circle">ğŸ“Œ</div>
                                <span style="color:var(--text-muted);">${brand}</span>
                            </div>
                            <div class="opening-location">${branchName}</div>
                            <div style="display:flex; gap:15px; margin-top:15px; font-size:0.85rem; color:#cbd5e1;">
                                <span>ğŸ‘¥ ${empCount} Ù…ÙˆØ¸Ù</span>
                                <span>âš ï¸ ${vioCount} Ù…Ø®Ø§Ù„ÙØ©</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } else if (container) {
                container.innerHTML = '<p style="color:#aaa; grid-column: 1/-1; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±ÙˆØ¹ Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« "Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†" Ø£Ùˆ "Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ÙˆØ­Ø¯".</p>';
            }
        });

        function openBranchModal(name, brand, empCount, violations, lic) {
            const modal = document.getElementById('branch-modal');
            
            // Set Header
            document.getElementById('modal-title').textContent = name;
            document.getElementById('modal-subtitle').textContent = brand;
            
            // Set KPIs
            document.getElementById('modal-emp-count').textContent = empCount;
            document.getElementById('modal-vio-count').textContent = violations.length;
            
            // Set Licenses (Baladiya)
            const baladiya = lic.store_license || {};
            const bStatus = baladiya.status || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            const bDate = baladiya.exp_g || baladiya.exp_h || '-';
            updateStatus('lic-baladiya-status', bStatus);
            document.getElementById('lic-baladiya-date').textContent = bDate;

            // Set Licenses (Civil Defense)
            const civil = lic.civil_defense || {};
            const cStatus = civil.status || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            const cDate = civil.exp_g || civil.exp_h || '-';
            updateStatus('lic-civil-status', cStatus);
            document.getElementById('lic-civil-date').textContent = cDate;

            // Permits
            const p24 = lic.permit_24?.status || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            updateStatus('lic-24h-status', p24);
            document.getElementById('lic-24h-text').textContent = p24;

            const pHd = lic.permit_hd?.status || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            updateStatus('lic-delivery-status', pHd);
            document.getElementById('lic-delivery-text').textContent = pHd;

            // Violations List
            const vList = document.getElementById('modal-violations-list');
            if(violations.length > 0) {
                vList.innerHTML = violations.map(v => `
                    <div style="padding:10px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between;">
                        <span>${v.type}</span>
                        <span style="color:${v.status==='Open'?'#f87171':'#34d399'}; font-size:0.8rem;">${v.status}</span>
                    </div>
                `).join('');
            } else {
                vList.innerHTML = '<div style="padding:15px; text-align:center; color:#64748b;">Ø³Ø¬Ù„ Ù†Ø¸ÙŠÙ! Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª.</div>';
            }

            modal.style.display = 'flex';
        }

        function updateStatus(id, status) {
            const el = document.getElementById(id);
            if(!el) return;
            el.textContent = status;
            
            // Color Logic
            status = status.toLowerCase();
            if(status.includes('valid') || status.includes('Ø³Ø§Ø±ÙŠ') || status.includes('yes') || status.includes('n/a')) {
                el.style.background = 'rgba(16, 185, 129, 0.2)';
                el.style.color = '#34d399';
            } else if (status.includes('expired') || status.includes('Ù…Ù†ØªÙ‡ÙŠ') || status.includes('no')) {
                el.style.background = 'rgba(239, 68, 68, 0.2)';
                el.style.color = '#f87171';
            } else {
                el.style.background = 'rgba(148, 163, 184, 0.2)';
                el.style.color = '#94a3b8';
            }
            el.style.padding = '2px 8px';
            el.style.borderRadius = '4px';
            el.style.fontSize = '0.8rem';
        }

        // Close Modal on Click Outside
        window.onclick = (e) => {
            const modal = document.getElementById('branch-modal');
            if(e.target === modal) modal.style.display = 'none';
        }
    </script>
</body>
</html>
                    const type = item.type || 'basic';
                    const brand = item.brand || 'Olayan';
                    const logo = item.logo || '';
                    
                    const div = document.createElement('div');
                    div.className = 'opening-card';
                    div.innerHTML = `
                        <div class="opening-content">
                            <span class="opening-status ${type==='opening' ? 'status-opening-soon' : 'status-now-open'}">${type==='opening'?'Ù‚Ø±ÙŠØ¨Ø§Ù‹':'Ù…ÙØªÙˆØ­'}</span>
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                                <div class="brand-logo-circle">${logo ? `<img src="${logo}" class="brand-logo-img">` : 'ğŸ“Œ'}</div>
                                <span style="color:var(--text-muted);">${brand}</span>
                            </div>
                            <div class="opening-location">${name}</div>
                            <div style="color:var(--text-muted); font-size:0.9rem;">
                                âœ… ÙŠØ¹Ù…Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } else if (container) {
                container.innerHTML = '<p style="color:#aaa; grid-column: 1/-1; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±ÙˆØ¹ Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</p>';
            }
        });
    </script>
</body>
</html>
